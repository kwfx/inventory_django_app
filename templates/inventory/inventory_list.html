{% extends "_base.html" %}
{% block title %}Inventaires{% endblock title %}
{% block content %}
{% if request.GET.not_found %}
<span>
  NOT FOUND
</span>
{% endif %}
<div class="inventory-list">
  <div class="d-flex justify-content-between mb-2">
    <a href="{% url 'inventory_create' %}" class="btn btn-primary float-left" role="button"
      aria-disabled="true">Créer</a>
    <form class="form-inline my-2 my-lg-0 d-flex">
      {{ search_form.zone.label_tag }}
      {{ search_form.zone }}
      {{ search_form.num_inv.label_tag }}
      {{ search_form.num_inv }}
      {{ search_form.product_ref.label_tag }}
      {{ search_form.product_ref }}
      <button class="btn btn-outline-success my-2 my-sm-0 me-1" type="submit">Search</button>
      <button class="btn btn-outline-info my-2 my-sm-0" onclick="_seachform_clear(event)">Clear</button>
    </form>
  </div>
  <table class="table table-hover">
    <thead style="position: sticky;top: 0;background-color: white;">
      <tr>
        <th scope="col">Zone</th>
        <th scope="col">Nombre de comptage</th>
        <th scope="col">Réf Interne</th>
        <th scope="col">Ancien réf</th>
        <th scope="col">Désignation</th>
        <th scope="col">Unité de vente</th>
        <th scope="col">Fournisseur</th>
        <th scope="col">Lot</th>
        <th scope="col">Quantité</th>
        <th scope="col">Unité</th>
        <th scope="col">Date péremption</th>
        <th scope="col" style="width: 80px;"></th>
      </tr>
    </thead>
    <tbody>
      {% for inv in inventory_list %}
      <tr class="inv-line">
        <td scope="col"><a>{{inv.zone.name}}</a></td>
        <td scope="col">{{inv.num_inventory}}</td>
        <td scope="col" colspan="9"></td>
        <td scope="col">
          <a href="{% url 'inventory_update' inv.id %}" class="fa fa-edit p-2" title="Modifier"></a>
          <a type="button" class="fa fa-trash text-danger btn-delete-inventory"
            onclick="_onClickDeleteInventory('{{inv.id}}')" title="Supprimer"></a>
        </td>
      </tr>
      {% for prodline in inv.inventory_product_lines.all %}
      {% if searched_product_ids == None or prodline.product.id in searched_product_ids %}
      <tr class="prod-line">
        <td scope="col" colspan="2"></td>
        <td scope="col">{{prodline.product.internal_ref}}</td>
        <td scope="col">{{prodline.product.old_ref}}</td>
        <td scope="col">{{prodline.product.designation}}</td>
        <td scope="col">{{prodline.product.get_sale_uom_display}}</td>
        <td scope="col">{{prodline.product.supplier}}</td>
        <td scope="col" colspan="5"></td>
      </tr>
      {% for lotline in prodline.product_lot_lines.all %}
      <tr class="lot-line">
        <td scope="col" colspan="7"></td>
        <td scope="col">{{lotline.lot}}</td>
        <td scope="col">{{lotline.quantity}}</td>
        <td scope="col">{{lotline.get_quantity_uom_display}}</td>
        <td scope="col">{{lotline.expiration_date|default_if_none:''}}</td>
        <td scope="col"></td>
        <td scope="col"></td>
      </tr>
      {% endfor %}
      {% endif %}
      {% endfor %}
      {% endfor %}
    </tbody>
  </table>
  <div title="Supprimer l'inventaire" style="display: none;">
    <p><span class="ui-icon ui-icon-alert" style="float:left; margin:12px 12px 20px 0;"></span>Continuer ?</p>
  </div>

  <div class="modal" id="dialog-delete" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Suppression de l'inventaire</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p>Confirmer ?</p>
        </div>
        <div class="modal-footer">
          <a type="button" class="btn btn-primary btn-confirm">Oui</a>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock content %}